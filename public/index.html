<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Ner̃t: we don't discriminate what you hate</title>

    <!--JQuERY ! THAT FUNKY QUERY!-->
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
        crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="./styles/styles.css">
    <script src='./scripts/utility.js'></script>
<script src="./scripts/gripes-widget.js"></script>
    <link rel="stylesheet" href="./styles/gripes-widget.css" />
    <script src="./scripts/app.js"></script>

</head>


<body>
    
    <jumbotron><img src='./images/NERTtemp.png' width='100%'></jumbotron>


    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2 col-sm-4 sidebar1">
                <div class="logo">
                    <img src="http://i.dailymail.co.uk/i/pix/2014/09/06/1409997457433_wps_12_Gerard_Butler_TELEVISION_.jpg" class="img-responsive center-block"
                        alt="Logo">
                </div>
                <br>
                <div class="left-navigation">
                    <ul class="list">
                        <br><br><br><br>
                        <h5><strong>FEATURED Stupid Social Network Channels</strong></h5>
                        <li><span id='facebook'>Wastebook</span></li>
                        <li>Shitter</li>
                        <li>StinkedIn</li>
                        <li>Whyspace</li>
                        <li>Stack OverHoe</li>
                        <li>Reddit</li>
                        <li>Borechan</li>
                        <li>UnCrapped</li>
                        <li>Yelp</li>
                    </ul>
                    <ul class="list">
                        <h5><strong>Miscellaneous Ner̃tiness</strong></h5>
                        <li>Misc. Rants</li>
                        <li>Terrible Pictures</li>
                        <li>General Whining</li>
                    </ul>
                    <ul class=list>
                        <h5><strong><a href='./newRant.html'>POST A RANT!</a></strong></h5>
                    </ul>
                </div>
            </div>
            <div class="col-md-10 col-sm-8 main-content">
                <!--MARQUEE of Uninspirational Quotes-->
                <marquee><span id='uninspirational'><b>UNINSPIRATIONAL QUOTES OF THE DAY: </b></span><span id='quote'></span></marquee>
                <!--Main content code to be written here -->
                <div id='welcomeMessage'>
                    <h1>Welcome to Ner̃t!</h1>
                    <h2>Do you hate people but like making fun of them?</h2>
                    <h3>You've found the right place! Here at Ner̃t, we don't discriminate what you hate!&trade;
                </div>
                <hr>
                <div class="display-results"></div>


            </div>
        </div>
    </div>
    </div>
    </div>
    </div>

</body>

<script>
    //Get all rants

    function buildAndDisplayRant(rant) {

        buildGripe(rant);

        $(".display-results").after(
            `<div id='${rant._id}' class='newsfeed'>
                        <span class='user'>
                            From User: <i>${createRandomUsername(moderatelyInsultingUsernames, modifiers)}
                            </i>
                        </span>
                        <br>
                        <span class='title'>
                            <h4>
                                <b>
                                    <u>Something stupid from 
                                    ${rant.channel}
                                    </u>
                                </b>
                            </h4>
                        </span>
                        <span class='contents'>
                            ${rant.content} 
                        </span>
                        <div class='responseDiv'>
                            <span class='clearButton'>
                                <button class='responseButton'>
                                    Leave a response!
                                 </button>
                            </span>
                            <div class="gripe-reaction"></div>
                            <div class='responseBox'>
                            </div>
                            
                        </div>
                        
                        <div class='testy'>
                        </div>
                        <div class='testy2'>
                        <b><u>Comments to the Dummies!</u></b><br>
                        ${splitComments(rant.listOfResponse)}
                        </div>
                         <div class="images">
                            <img src='.${pickRandom(imageLinks)}' class='imagio'>
                        </div>
                        
                    </div>`
        ); //closes out append after~display results
    }

    function splitComments(arr) {
        var responseListHtml = ""
        for (var i = arr.length-1; i > 1; i--) {
            responseListHtml += (arr[i] + '<hr />')
        }
        return responseListHtml;
    }

    function buildComment(rant) {
       // console.log("RANT ID", rant._id);
        var newComment =
            `<div style="display: none;" class="new-link" name="link[]" >
                    <textarea cols="40" rows="1"class="newResponse" placeholder="enter a response!"/>
                    <br>
                    <button class="submitbutton" data-rantID="${rant._id}">
                        Submit
                    </button>
                </div>`
        return newComment;
    }


    function buildClickHandler() {
        var newComment = buildComment(rant);
        //append new comment to response box  

        var rantId = rant._id;
        //find response box for rant

        $(newComment).appendTo($(`#${rantId}`).find(".responseBox")).slideDown("fast");

        //clear response button
        $('.clearButton').text('');
        $(`#${rantId}`).find('.submitbutton').click(function () {
            var rantId = this.dataset.rantid;
            var responseContent = $(`#${rantId}`).find('.newResponse').val();
            var responseStyle =
                `<div class="responses">
                    <b>Response to the Stupidity:</b>
                    <br> 
                    ${responseContent}
                </div>`

            if (!responseContent) {
                alert('YOU NEED TO ENTER A RESPONSE, DUMMY!')
            }
            else {
                $(`#${rantId}`).find('.testy').append(responseStyle);
                $(`#${rantId}`).find('.newResponse').val('');
                $(`#${rantId}`).find('.newResponse').text(newComment);
                $.post("/api/response/" + rantId, {
                    response: responseContent,
                });//closes out $.post
            }//close out else statement
        });//closes out submit click handler
    }

    $.get("/api/rants", function (rants) {
        for (rant of rants) {
            //console.log("BUILDING RANT");
            buildAndDisplayRant(rant);
            //create unique container
            //grab general class withing unique container with .find()
            $(".responseButton").click(buildClickHandler());//closes out response click handler

        } //closes out for loop 


    }); //closes out $.get



    
    $('#quote').append(pickRandomAtInterval(uninspirationalQuotes, 2, "second"));

</script>
</body>

</html>